<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°—É–¥–µ–±–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ | –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Roboto Serif –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #eef2f7;
            margin: 0;
            padding-bottom: 50px;
        }
        .nav {
            background: #1a237e;
            color: #fff;
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #c5a059;
        }
        .nav a {
            color: #ffd700;
            text-decoration: none;
            font-weight: bold;
            margin-left: 15px;
        }
        .container {
            max-width: 1000px;
            margin: 20px auto;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            font-size: 0.85em;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        textarea { resize: vertical; }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .btn-send {
            background: #c5a059;
            color: white;
            padding: 15px;
            border: none;
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            font-size: 1.1em;
        }
        .btn-send:disabled {
            opacity: 0.6;
            cursor: wait;
        }
        .case-image {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            margin-left: 6px;
        }
        .badge-new { background: #e3f2fd; color: #1565c0; }
        .badge-court { background: #fff3cd; color: #856404; }

        #paper-canvas {
            position: absolute;
            left: -9999px;
            top: 0;
        }
    </style>
</head>
<body>

<div class="nav">
    <h2>‚öñÔ∏è –ö–ê–ù–¶–ï–õ–Ø–†–ò–Ø –°–£–î–ê</h2>
    <div>
        <strong>{{ user.username }}</strong> ({{ user.role }})
        <a href="/logout">–í—ã–π—Ç–∏</a>
    </div>
</div>

<div class="container">
    <!-- –§–û–†–ú–ê -->
    <div class="card">
        <h3 style="margin-top:0">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏—Å–∫–æ–≤–æ–≥–æ –∑–∞—è–≤–ª–µ–Ω–∏—è</h3>

        <div class="form-grid">
            <div>
                <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—É–¥–∞ (–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°—É–¥–∞1):</label>
                <select id="f_court1">
                    <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–¥</option>
                    <option>–í–µ—Ä—Ö–æ–≤–Ω—ã–π –°—É–¥</option>
                    <option>–ö–∞—Å—Å–∞—Ü–∏–æ–Ω–Ω—ã–π –°—É–¥</option>
                    <option>–°—É–¥ –ø–æ –£–≥–æ–ª–æ–≤–Ω—ã–º –¥–µ–ª–∞–º</option>
                    <option>–°—É–¥ –ø–æ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–µ–ª–∞–º</option>
                    <option>–°—É–¥ –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–º –¥–µ–ª–∞–º</option>
                </select>
            </div>
            <div>
                <label>–ù–ê–ò–ú–ï–ù–û–í–ê–ù–ò–ï –ü–†–û–¶–ï–°–°–ê:</label>
                <select id="f_process">
                    <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏—Å–∫–∞</option>

                    <option disabled>1. –°–µ–º–µ–π–Ω—ã–µ —Å–ø–æ—Ä—ã</option>
                    <option>—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –±—Ä–∞–∫–∞ (—Ä–∞–∑–≤–æ–¥)</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –±—Ä–∞–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –∞–ª–∏–º–µ–Ω—Ç–æ–≤ (–Ω–∞ –¥–µ—Ç–µ–π, –Ω–µ—Ç—Ä—É–¥–æ—Å–ø–æ—Å–æ–±–Ω–æ–≥–æ —Å—É–ø—Ä—É–≥–∞, —Ä–æ–¥–∏—Ç–µ–ª–µ–π)</option>
                    <option>—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—Ü–æ–≤—Å—Ç–≤–∞</option>
                    <option>–æ—Å–ø–∞—Ä–∏–≤–∞–Ω–∏–µ –æ—Ç—Ü–æ–≤—Å—Ç–≤–∞ (–º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–∞)</option>
                    <option>–ª–∏—à–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤</option>
                    <option>–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤</option>
                    <option>–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞ —Ä–µ–±–µ–Ω–∫–∞</option>
                    <option>–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –æ–±—â–µ–Ω–∏—è —Å —Ä–µ–±–µ–Ω–∫–æ–º (–ø–æ—Ä—è–¥–æ–∫ –≤—Å—Ç—Ä–µ—á)</option>
                    <option>—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∫ –æ–±—â–µ–Ω–∏—é —Å —Ä–µ–±–µ–Ω–∫–æ–º</option>
                    <option>—Ä–∞–∑–¥–µ–ª —Å–æ–≤–º–µ—Å—Ç–Ω–æ –Ω–∞–∂–∏—Ç–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞ —Å—É–ø—Ä—É–≥–æ–≤</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –Ω–µ—É—Å—Ç–æ–π–∫–∏ –ø–æ –∞–ª–∏–º–µ–Ω—Ç–∞–º</option>

                    <option disabled>2. –ñ–∏–ª–∏—â–Ω—ã–µ —Å–ø–æ—Ä—ã</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∂–∏–ª—ã–º –ø–æ–º–µ—â–µ–Ω–∏–µ–º</option>
                    <option>–≤—Å–µ–ª–µ–Ω–∏–µ</option>
                    <option>–≤—ã—Å–µ–ª–µ–Ω–∏–µ</option>
                    <option>—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–º—É—â–µ—Å—Ç–≤–æ–º</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —É—Ç—Ä–∞—Ç–∏–≤—à–∏–º –ø—Ä–∞–≤–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∂–∏–ª—ã–º –ø–æ–º–µ—â–µ–Ω–∏–µ–º</option>
                    <option>–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∂–∏–ª—ã–º –ø–æ–º–µ—â–µ–Ω–∏–µ–º (–∫–æ–º–Ω–∞—Ç–æ–π, –∫–≤–∞—Ä—Ç–∏—Ä–æ–π)</option>
                    <option>–ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–∞–≤ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –Ω–∞–π–º–∞</option>
                    <option>–ø—Ä–∏–≤–∞—Ç–∏–∑–∞—Ü–∏—è –∂–∏–ª–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞ –∂–∏–ª—ã–º–∏ –ø–æ–º–µ—â–µ–Ω–∏—è–º–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º</option>

                    <option disabled>3. –ò–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Ä—ã, –ø—Ä–∞–≤–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</option>
                    <option>–∏—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞ –∏–∑ —á—É–∂–æ–≥–æ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –≤–ª–∞–¥–µ–Ω–∏—è (–≤–∏–Ω–¥–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π)</option>
                    <option>—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø—Ä–∞–≤–∞, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ª–∏—à–µ–Ω–∏–µ–º –≤–ª–∞–¥–µ–Ω–∏—è (–Ω–µ–≥–∞—Ç–æ—Ä–Ω—ã–π)</option>
                    <option>—Ä–∞–∑–¥–µ–ª –∏–º—É—â–µ—Å—Ç–≤–∞ (–¥–æ–ª–µ–≤–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)</option>
                    <option>–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–º—É—â–µ—Å—Ç–≤–æ–º</option>
                    <option>–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç –∞—Ä–µ—Å—Ç–∞ (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –æ–ø–∏—Å–∏)</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —Å–∞–º–æ–≤–æ–ª—å–Ω–æ–π –ø–æ—Å—Ç—Ä–æ–π–∫–∏</option>

                    <option disabled>4. –ó–µ–º–µ–ª—å–Ω—ã–µ —Å–ø–æ—Ä—ã</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫</option>
                    <option>—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–º–µ–∂–µ–≤–∞–Ω–∏–µ)</option>
                    <option>—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∑–µ–º–µ–ª—å–Ω—ã–º —É—á–∞—Å—Ç–∫–æ–º</option>
                    <option>–∏—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –∏–∑ —á—É–∂–æ–≥–æ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –≤–ª–∞–¥–µ–Ω–∏—è</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –∞–∫—Ç–∞ –æ—Ä–≥–∞–Ω–∞ –≤–ª–∞—Å—Ç–∏ –æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞</option>

                    <option disabled>5. –ù–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Ä—ã</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∑–∞–≤–µ—â–∞–Ω–∏—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç–æ–π–Ω—ã–º</option>
                    <option>–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞</option>
                    <option>—Ä–∞–∑–¥–µ–ª –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ</option>

                    <option disabled>6. –î–æ–≥–æ–≤–æ—Ä–Ω—ã–µ —Å–ø–æ—Ä—ã –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–æ–ª–≥–∞)</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –Ω–µ—É—Å—Ç–æ–π–∫–∏ (–ø–µ–Ω–∏, —à—Ç—Ä–∞—Ñ–∞)</option>
                    <option>—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º (–Ω–∏—á—Ç–æ–∂–Ω—ã–º –∏–ª–∏ –æ—Å–ø–æ—Ä–∏–º—ã–º)</option>
                    <option>–ø–æ–Ω—É–∂–¥–µ–Ω–∏–µ –∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä</option>
                    <option>–∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–æ–≥–æ–≤–æ—Ä–∞</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –Ω–µ–æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ–≥–∞—â–µ–Ω–∏—è</option>

                    <option disabled>7. –ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π</option>
                    <option>–≤–æ–∑–≤—Ä–∞—Ç —É–ø–ª–∞—á–µ–Ω–Ω–æ–π —Å—É–º–º—ã –∑–∞ —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É</option>
                    <option>–∑–∞–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</option>
                    <option>—Å–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–∫—É–ø–Ω–æ–π —Ü–µ–Ω—ã</option>
                    <option>–±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –Ω–µ—É—Å—Ç–æ–π–∫–∏ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π</option>
                    <option>–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –º–æ—Ä–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–¥–∞</option>

                    <option disabled>8. –¢—Ä—É–¥–æ–≤—ã–µ —Å–ø–æ—Ä—ã</option>
                    <option>–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∑–∞ –∑–∞–¥–µ—Ä–∂–∫—É –∑–∞—Ä–ø–ª–∞—Ç—ã</option>
                    <option>–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–ø—É—Å–∫</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–º</option>
                    <option>–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏—á–∏–Ω—ã —É–≤–æ–ª—å–Ω–µ–Ω–∏—è</option>
                    <option>–≤–∑—ã—Å–∫–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å–æ–±–∏—è</option>

                    <option disabled>9. –°–ø–æ—Ä—ã –æ –≤–æ–∑–º–µ—â–µ–Ω–∏–∏ –≤—Ä–µ–¥–∞</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ —É—â–µ—Ä–±–∞</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–¥–∞, –ø—Ä–∏—á–∏–Ω–µ–Ω–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—é</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–¥–∞ –≤ —Å–≤—è–∑–∏ —Å–æ —Å–º–µ—Ä—Ç—å—é –∫–æ—Ä–º–∏–ª—å—Ü–∞</option>
                    <option>–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –º–æ—Ä–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–¥–∞</option>
                    <option>–≤–æ–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–¥–∞, –ø—Ä–∏—á–∏–Ω–µ–Ω–Ω–æ–≥–æ –≤—Å–ª–µ–¥—Å—Ç–≤–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏</option>

                    <option disabled>10. –°–ø–æ—Ä—ã —Å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è, –¥–µ–π—Å—Ç–≤–∏—è (–±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è) –æ—Ä–≥–∞–Ω–∞ –≤–ª–∞—Å—Ç–∏/—á–∏–Ω–æ–≤–Ω–∏–∫–∞</option>
                    <option>–æ—Å–ø–∞—Ä–∏–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–∫—Ç–∞</option>
                    <option>–≤–æ–∑–ª–æ–∂–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å–æ–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç)</option>
                    <option>–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º–æ–π –æ—Ç–≤–µ—Ç—á–∏–∫–æ–º, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</option>
                </select>
            </div>
        </div>

        <div class="form-grid">
            <div>
                <label>–ò—Å—Ç–µ—Ü ‚Äî –§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ1:</label>
                <input type="text" id="f_fio1" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ">
                <label>–ê–¥—Ä–µ—Å1:</label>
                <input type="text" id="f_addr1" placeholder="–ê–¥—Ä–µ—Å –∏—Å—Ç—Ü–∞">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω1:</label>
                <input type="text" id="f_tel1" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏—Å—Ç—Ü–∞">
            </div>
            <div>
                <label>–û—Ç–≤–µ—Ç—á–∏–∫ ‚Äî –§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ2:</label>
                <input type="text" id="f_fio2" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ">
                <label>–ê–¥—Ä–µ—Å2:</label>
                <input type="text" id="f_addr2" placeholder="–ê–¥—Ä–µ—Å –æ—Ç–≤–µ—Ç—á–∏–∫–∞">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω2:</label>
                <input type="text" id="f_tel2" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç–≤–µ—Ç—á–∏–∫–∞">
            </div>
        </div>

        <label>–°—É—Ç—å –∏—Å–∫–æ–≤–æ–≥–æ –∑–∞—è–≤–ª–µ–Ω–∏—è (3 —Å—Ç—Ä–æ–∫–∏, –∫–∞–∂–¥–∞—è –¥–æ ~80 —Å–∏–º–≤–æ–ª–æ–≤):</label>
        <input type="text" id="f_line1" placeholder="–°—Ç—Ä–æ–∫–∞ 1">
        <input type="text" id="f_line2" placeholder="–°—Ç—Ä–æ–∫–∞ 2">
        <input type="text" id="f_line3" placeholder="–°—Ç—Ä–æ–∫–∞ 3">

        <div class="form-grid" style="margin-top:15px;">
            <div>
                <label>–ü–æ–¥–ø–∏—Å—å (–§–∞–º–∏–ª–∏—è –ò.–û.):</label>
                <input type="text" id="f_sign" placeholder="–§–∞–º–∏–ª–∏—è –ò.–û.">
            </div>
            <div>
                <label>–î–∞—Ç–∞:</label>
                <div style="display:flex;gap:6px;">
                    <input type="text" id="f_day"   placeholder="01" style="width:60px;">
                    <input type="text" id="f_month" placeholder="—è–Ω–≤–∞—Ä—è" style="flex:1;">
                    <input type="text" id="f_year"  placeholder="26" style="width:70px;">
                </div>
                <small style="color:#777;">–§–æ—Ä–º–∞—Ç: 01 —è–Ω–≤–∞—Ä—è 26</small>
            </div>
        </div>

        <button class="btn-send" onclick="generateAndSend()">–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ò –û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)</button>
    </div>

    <!-- –°–ü–ò–°–û–ö –î–ï–õ -->
    <div class="card">
        <h3>üìÇ –î–µ–ª–∞, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h3>
        {% if cases %}
            {% for case in cases %}
                <div style="margin-bottom:20px;">
                    <p>
                        <strong>–î–µ–ª–æ {{ case.case_num }}</strong>
                        <span class="badge badge-court">{{ case.court_type }}</span>
                        <span class="badge badge-new">{{ case.status }}</span><br>
                        <small>–î–∞—Ç–∞: {{ case.date.strftime('%d.%m.%Y %H:%M') }} UTC</small>
                    </p>
                    <img src="{{ case.image_data }}" class="case-image">
                </div>
            {% endfor %}
        {% else %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–ª.</p>
        {% endif %}
    </div>
</div>

<canvas id="paper-canvas" width="795" height="1123"></canvas>

<script>
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–¥ —Ç–≤–æ–π PNG (–ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ–¥–æ–≥–Ω–∞–Ω—ã –ø–æ–¥ —Å–∫—Ä–∏–Ω)
    const points = {
        court1: {x:430, y:100},  // "–í ________"
        fio1:   {x:460, y:200},  // –ò—Å—Ç–µ—Ü –§–ò–û
        addr1:  {x:460, y:235},  // –ò—Å—Ç–µ—Ü –∞–¥—Ä–µ—Å
        tel1:   {x:460, y:270},  // –ò—Å—Ç–µ—Ü —Ç–µ–ª–µ—Ñ–æ–Ω
        fio2:   {x:460, y:330},  // –û—Ç–≤–µ—Ç—á–∏–∫ –§–ò–û
        addr2:  {x:460, y:365},  // –û—Ç–≤–µ—Ç—á–∏–∫ –∞–¥—Ä–µ—Å
        tel2:   {x:460, y:400},  // –û—Ç–≤–µ—Ç—á–∏–∫ —Ç–µ–ª–µ—Ñ–æ–Ω
        process:{x:305, y:470},  // –ø–æ—Å–ª–µ "–æ"
        line1:  {x:105, y:520},  // —Å—É—Ç—å —Å—Ç—Ä–æ–∫–∞ 1
        line2:  {x:105, y:545},  // —Å—É—Ç—å —Å—Ç—Ä–æ–∫–∞ 2
        line3:  {x:105, y:570},  // —Å—É—Ç—å —Å—Ç—Ä–æ–∫–∞ 3
        sign:   {x:100, y:990},  // –ø–æ–¥–ø–∏—Å—å
        day:    {x:520, y:990},  // ¬´__¬ª DD
        month:  {x:565, y:990},  // –º–µ—Å—è—Ü
        year:   {x:700, y:990}   // –≥–æ–¥
    };

    const bgImage = new Image();
    bgImage.src = "/static/court_template.png";

    function drawText(ctx, text, x, y, font, bold=false) {
        ctx.font = (bold ? 'bold ' : '') + font;
        ctx.fillStyle = "#000000";
        ctx.textBaseline = "top";
        ctx.fillText(text, x, y);
    }

    async function generateAndSend() {
        const btn = document.querySelector('.btn-send');
        btn.disabled = true;
        btn.textContent = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PNG...";

        const required = ['f_court1','f_process','f_fio1','f_fio2','f_sign','f_day','f_month','f_year'];
        for (const id of required) {
            const el = document.getElementById(id);
            if (!el.value || !el.value.trim()) {
                alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—É–¥, –ø—Ä–æ—Ü–µ—Å—Å, –§–ò–û –∏—Å—Ç—Ü–∞/–æ—Ç–≤–µ—Ç—á–∏–∫–∞, –ø–æ–¥–ø–∏—Å—å –∏ –¥–∞—Ç—É.");
                btn.disabled = false;
                btn.textContent = "–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ò –û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)";
                return;
            }
        }

        await new Promise(resolve => {
            if (bgImage.complete) return resolve();
            bgImage.onload = resolve;
            bgImage.onerror = () => { alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω PNG"); resolve(); };
        });

        const canvas = document.getElementById('paper-canvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);

        const v = {
            court1: document.getElementById('f_court1').value,
            fio1:   document.getElementById('f_fio1').value,
            addr1:  document.getElementById('f_addr1').value,
            tel1:   document.getElementById('f_tel1').value,
            fio2:   document.getElementById('f_fio2').value,
            addr2:  document.getElementById('f_addr2').value,
            tel2:   document.getElementById('f_tel2').value,
            process:document.getElementById('f_process').value,
            line1:  document.getElementById('f_line1').value,
            line2:  document.getElementById('f_line2').value,
            line3:  document.getElementById('f_line3').value,
            sign:   document.getElementById('f_sign').value,
            day:    document.getElementById('f_day').value,
            month:  document.getElementById('f_month').value,
            year:   document.getElementById('f_year').value
        };

        const mainFont = '11pt "Roboto Serif"';
        const tnFont   = '13pt "Times New Roman"';

        // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—É–¥–∞
        drawText(ctx, v.court1, points.court1.x, points.court1.y, mainFont, false);

        // –ò—Å—Ç–µ—Ü (–§–ò–û –∂–∏—Ä–Ω—ã–π)
        drawText(ctx, v.fio1,  points.fio1.x,  points.fio1.y,  mainFont, true);
        drawText(ctx, v.addr1, points.addr1.x, points.addr1.y, mainFont, false);
        drawText(ctx, v.tel1,  points.tel1.x,  points.tel1.y,  mainFont, false);

        // –û—Ç–≤–µ—Ç—á–∏–∫ (–§–ò–û –∂–∏—Ä–Ω—ã–π)
        drawText(ctx, v.fio2,  points.fio2.x,  points.fio2.y,  mainFont, true);
        drawText(ctx, v.addr2, points.addr2.x, points.addr2.y, mainFont, false);
        drawText(ctx, v.tel2,  points.tel2.x,  points.tel2.y,  mainFont, false);

        // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–∂–∏—Ä–Ω—ã–π)
        drawText(ctx, v.process, points.process.x, points.process.y, mainFont, true);

        // –°—É—Ç—å ‚Äì —Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏
        if (v.line1) drawText(ctx, v.line1, points.line1.x, points.line1.y, mainFont, false);
        if (v.line2) drawText(ctx, v.line2, points.line2.x, points.line2.y, mainFont, false);
        if (v.line3) drawText(ctx, v.line3, points.line3.x, points.line3.y, mainFont, false);

        // –ü–æ–¥–ø–∏—Å—å –∏ –¥–∞—Ç–∞ ‚Äì Times New Roman 13
        drawText(ctx, v.sign, points.sign.x, points.sign.y, tnFont, false);
        drawText(ctx, v.day,   points.day.x,   points.day.y,   tnFont, false);
        drawText(ctx, v.month, points.month.x, points.month.y, tnFont, false);
        drawText(ctx, v.year,  points.year.x,  points.year.y,  tnFont, false);

        const imageData = canvas.toDataURL("image/png");
        const courtType = v.court1 || "–í–µ—Ä—Ö–æ–≤–Ω—ã–π –°—É–¥";

        try {
            const response = await fetch('/save_case_image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    image: imageData,
                    court_type: courtType
                })
            });
            if (response.ok) {
                const res = await response.json();
                alert("–ò—Å–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ù–æ–º–µ—Ä –¥–µ–ª–∞: " + res.case_num);
                location.reload();
            } else {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.");
                btn.disabled = false;
                btn.textContent = "–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ò –û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)";
            }
        } catch (e) {
            console.error(e);
            alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.");
            btn.disabled = false;
            btn.textContent = "–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ò –û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)";
        }
    }
</script>
</body>
</html>
