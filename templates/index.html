<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°—É–¥–µ–±–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ | –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f7; margin: 0; padding-bottom: 50px; }
        .nav { background: #1a237e; color: #fff; padding: 15px 50px; display: flex; justify-content: space-between; border-bottom: 4px solid #c5a059; }
        .container { max-width: 900px; margin: 20px auto; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.85em; color: #555; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn-send { background: #c5a059; color: white; padding: 15px; border: none; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; font-size: 1.1em; }
        
        /* --- –°–¢–ò–õ–ò –ë–õ–ê–ù–ö–ê –ê4 (–°–ö–†–´–¢–´–ô –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò) --- */
        #paper-template {
            width: 794px; /* –†–∞–∑–º–µ—Ä –ê4 –ø—Ä–∏ 96 DPI */
            height: 1123px;
            padding: 60px 80px;
            background: white;
            position: absolute;
            left: -9999px; /* –ü—Ä—è—á–µ–º –µ–≥–æ –∑–∞ —ç–∫—Ä–∞–Ω */
            top: 0;
            box-sizing: border-box;
            color: black;
            line-height: 1.3;
        }
        .a4-header { margin-left: auto; width: 60%; text-align: right; }
        .a4-header p { margin: 2px 0; font-size: 14pt; font-family: "Times New Roman", serif; }
        .line-under { border-bottom: 1px solid black; display: inline-block; width: 100%; min-height: 20px; text-align: center; font-weight: bold; }
        .small-hint { font-size: 8pt; display: block; text-align: center; margin-top: -2px; }
        .a4-title { text-align: center; margin-top: 50px; text-transform: uppercase; font-weight: bold; }
        .a4-content { margin-top: 30px; text-indent: 40px; font-size: 13pt; min-height: 300px; white-space: pre-wrap; word-wrap: break-word; }
        .a4-footer { margin-top: 50px; display: flex; justify-content: space-between; align-items: flex-end; }
        
        /* –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ —Å–∞–π—Ç–µ */
        .case-image { width: 100%; border: 1px solid #ddd; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="nav">
    <h2>‚öñÔ∏è –ö–ê–ù–¶–ï–õ–Ø–†–ò–Ø –°–£–î–ê</h2>
    <div>{{ user.username }}</div>
</div>

<div class="container">
    <div class="card">
        <h3 style="margin-top:0">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏—Å–∫–æ–≤–æ–≥–æ –∑–∞—è–≤–ª–µ–Ω–∏—è</h3>
        <div class="form-grid">
            <div>
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–¥:</label>
                <select id="f_court">
                    <option>–í–µ—Ä—Ö–æ–≤–Ω—ã–π —Å—É–¥</option>
                    <option>–ö–∞—Å—Å–∞—Ü–∏–æ–Ω–Ω—ã–π –°—É–¥</option>
                    <option>–°—É–¥ –ø–æ –£–≥–æ–ª–æ–≤–Ω—ã–º –∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–µ–ª–∞–º</option>
                    <option>–°—É–¥ –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–º –¥–µ–ª–∞–º</option>
                </select>
            </div>
            <div>
                <label>–¢–∏–ø –ø—Ä–æ—Ü–µ—Å—Å–∞:</label>
                <select id="f_type">
                    <optgroup label="1. –°–µ–º–µ–π–Ω—ã–µ —Å–ø–æ—Ä—ã">
                        <option>–ò—Å–∫ –æ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–∏ –±—Ä–∞–∫–∞ (—Ä–∞–∑–≤–æ–¥)</option>
                        <option>–ò—Å–∫ –æ –≤–∑—ã—Å–∫–∞–Ω–∏–∏ –∞–ª–∏–º–µ–Ω—Ç–æ–≤</option>
                        <option>–ò—Å–∫ –æ –ª–∏—à–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤</option>
                    </optgroup>
                    <optgroup label="2. –ñ–∏–ª–∏—â–Ω—ã–µ —Å–ø–æ—Ä—ã">
                        <option>–ò—Å–∫ –æ –≤—Å–µ–ª–µ–Ω–∏–∏</option>
                        <option>–ò—Å–∫ –æ –≤—ã—Å–µ–ª–µ–Ω–∏–∏</option>
                    </optgroup>
                    </select>
            </div>
        </div>

        <div class="form-grid">
            <div>
                <label>–§–ò–û –ò—Å—Ç—Ü–∞:</label>
                <input type="text" id="f_istec" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                <label>–ê–¥—Ä–µ—Å –ò—Å—Ç—Ü–∞:</label>
                <input type="text" id="f_istec_addr" placeholder="–≥. –õ–æ—Å-–°–∞–Ω—Ç–æ—Å, —É–ª. –õ–µ–Ω–∏–Ω–∞">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω –ò—Å—Ç—Ü–∞:</label>
                <input type="text" id="f_istec_phone" placeholder="777-888">
            </div>
            <div>
                <label>–§–ò–û –û—Ç–≤–µ—Ç—á–∏–∫–∞:</label>
                <input type="text" id="f_otvet" placeholder="–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á">
                <label>–ê–¥—Ä–µ—Å –û—Ç–≤–µ—Ç—á–∏–∫–∞:</label>
                <input type="text" id="f_otvet_addr" placeholder="–≥. –õ–æ—Å-–°–∞–Ω—Ç–æ—Å, —É–ª. –ú–∏—Ä–∞">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω –û—Ç–≤–µ—Ç—á–∏–∫–∞:</label>
                <input type="text" id="f_otvet_phone" placeholder="555-444">
            </div>
        </div>

        <label>–°—É—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏—è:</label>
        <textarea id="f_text" rows="5" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é..."></textarea>
        
        <label>–í–∞—à–∞ –ø–æ–¥–ø–∏—Å—å (–§–∞–º–∏–ª–∏—è –ò.–û.):</label>
        <input type="text" id="f_sign" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">

        <button class="btn-send" onclick="generateAndSend()">–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ò –û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)</button>
    </div>

    <div id="casesList">
        <h3>üìÇ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏—Å–∫–∏ (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä)</h3>
        {% for case in cases %}
            <div class="card">
                <p><strong>–î–µ–ª–æ ‚Ññ{{ case.case_num }}</strong></p>
                <img src="{{ case.image_url }}" class="case-image">
            </div>
        {% endfor %}
    </div>
</div>

<div id="paper-template">
    <div class="a4-header">
        <p>–í <span id="p_court" class="line-under"></span></p>
        <span class="small-hint">(–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—É–¥–µ–±–Ω–æ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏)</span>
        
        <div style="margin-top:20px">
            <p>–ò—Å—Ç–µ—Ü: <span id="p_istec" class="line-under"></span></p>
            <p>–ê–¥—Ä–µ—Å: <span id="p_istec_addr" class="line-under"></span></p>
            <p>–¢–µ–ª–µ—Ñ–æ–Ω: <span id="p_istec_phone" class="line-under"></span></p>
        </div>

        <div style="margin-top:20px">
            <p>–û—Ç–≤–µ—Ç—á–∏–∫: <span id="p_otvet" class="line-under"></span></p>
            <p>–ê–¥—Ä–µ—Å: <span id="p_otvet_addr" class="line-under"></span></p>
            <p>–¢–µ–ª–µ—Ñ–æ–Ω: <span id="p_otvet_phone" class="line-under"></span></p>
        </div>
    </div>

    <div class="a4-title">
        –ò—Å–∫–æ–≤–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ<br>
        –æ <span id="p_type"></span>
    </div>

    <div class="a4-content" id="p_text"></div>

    <p style="font-size: 11pt; margin-top: 40px;">
        –ù–∞ –∑–∞–∫–æ–Ω–Ω—ã—Ö –æ—Å–Ω–æ–≤–∞–Ω–∏—è—Ö, –∏–∑–ª–æ–∂–µ–Ω–Ω—ã—Ö –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–µ–π –∏ –∏–Ω—ã–º–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º–∏ –∞–∫—Ç–∞–º–∏, –ø—Ä–æ—à—É –°—É–¥ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω–æ–µ –º–æ—ë –∏—Å–∫–æ–≤–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ä—ã –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –¥–∞–Ω–Ω–æ–º—É –¥–µ–ª—É.
    </p>

    <div style="font-size: 11pt; margin-top: 20px;">
        –ö –ò—Å–∫–æ–≤–æ–º—É –∑–∞—è–≤–ª–µ–Ω–∏—é –ø—Ä–∏–ª–∞–≥–∞—é:<br>
        1. –ö–æ–ø–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫: –ø–∞—Å–ø–æ—Ä—Ç, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∫–∞—Ä—Ç–∞, –ø–∞–∫–µ—Ç –ª–∏—Ü–µ–Ω–∑–∏–π<br>
        2. –ö–≤–∏—Ç–∞–Ω—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –≥–æ—Å–ø–æ—à–ª–∏–Ω—ã.
    </div>

    <div class="a4-footer">
        <div style="width: 200px; text-align: center;">
            <div style="border-bottom: 1px solid black; min-height: 30px;"></div>
            <span class="small-hint">( –ø–æ–¥–ø–∏—Å—å )</span>
        </div>
        <div style="width: 200px; text-align: center;">
            <div id="p_sign" style="border-bottom: 1px solid black; min-height: 30px; font-weight: bold;"></div>
            <span class="small-hint">( —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ )</span>
        </div>
        <div>
            ¬´<span id="p_day"></span>¬ª <span id="p_month"></span> 2026 –≥.
        </div>
    </div>
</div>

<script>
    // –ñ–∏–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–ª–∞–Ω–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
    const fields = ['court','istec','istec_addr','istec_phone','otvet','otvet_addr','otvet_phone','type','text','sign'];
    fields.forEach(f => {
        document.getElementById('f_'+f).addEventListener('input', (e) => {
            document.getElementById('p_'+f).innerText = e.target.value;
        });
    });

    async function generateAndSend() {
        const btn = document.querySelector('.btn-send');
        btn.innerText = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PNG...";
        btn.disabled = true;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –±–ª–∞–Ω–∫
        const now = new Date();
        document.getElementById('p_day').innerText = now.getDate();
        const months = ["—è–Ω–≤–∞—Ä—è","—Ñ–µ–≤—Ä–∞–ª—è","–º–∞—Ä—Ç–∞","–∞–ø—Ä–µ–ª—è","–º–∞—è","–∏—é–Ω—è","–∏—é–ª—è","–∞–≤–≥—É—Å—Ç–∞","—Å–µ–Ω—Ç—è–±—Ä—è","–æ–∫—Ç—è–±—Ä—è","–Ω–æ—è–±—Ä—è","–¥–µ–∫–∞–±—Ä—è"];
        document.getElementById('p_month').innerText = months[now.getMonth()];

        // 1. –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ –±–ª–æ–∫–∞
        const template = document.getElementById('paper-template');
        const canvas = await html2canvas(template, { scale: 2 }); // scale 2 –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
        const imageData = canvas.toDataURL("image/png");

        // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±—ç–∫–µ–Ω–¥ (—á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∏ –Ω–∞ —Å–∞–π—Ç)
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–≤–æ–π fetch –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ Python/Node
        // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–∏–º —Å—Ä–∞–∑—É –≤ Discord —á–µ—Ä–µ–∑ JS:
        
        const webhookURL = "–¢–í–û–ô_–í–ï–ë–•–£–ö_–î–ò–°–ö–û–†–î"; // –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å—Å—ã–ª–∫—É
        
        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º base64 –≤ —Ñ–∞–π–ª –¥–ª—è –î–∏—Å–∫–æ—Ä–¥–∞
        const res = await fetch(imageData);
        const blob = await res.blob();
        const formData = new FormData();
        formData.append('file', blob, '–∏—Å–∫.png');
        formData.append('payload_json', JSON.stringify({
            content: "‚öñÔ∏è **–ü–æ—Å—Ç—É–ø–∏–ª–æ –Ω–æ–≤–æ–µ –∏—Å–∫–æ–≤–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ –≤ –≤–∏–¥–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ê4**"
        }));

        try {
            await fetch(webhookURL, { method: 'POST', body: formData });
            alert("–ò—Å–∫ —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –≤–∏–¥–µ PNG!");
            location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏! –ü—Ä–æ–≤–µ—Ä—å Webhook URL.");
            btn.disabled = false;
            btn.innerText = "–û–¢–ü–†–ê–í–ò–¢–¨ –ò–°–ö (PNG)";
        }
    }
</script>

</body>
</html>
