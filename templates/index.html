<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°—É–¥–µ–±–Ω—ã–π –ü–æ—Ä—Ç–∞–ª</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f7; margin: 0; color: #2c3e50; }
        .nav { background: #1a237e; color: #fff; padding: 15px 50px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid #c5a059; }
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px; position: relative; overflow: hidden; }
        
        /* –°—Ç–∞—Ç—É—Å—ã-–ø–æ–ª–æ—Å–∫–∏ */
        .status-–ù–æ–≤—ã–π { border-left: 8px solid #c5a059; }
        .status-–í-—Ä–∞–±–æ—Ç–µ { border-left: 8px solid #3498db; }
        .status-–ó–∞–≤–µ—Ä—à–µ–Ω { border-left: 8px solid #27ae60; }

        .btn { background: #1a237e; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-block; }
        .btn-sm { padding: 6px 12px; font-size: 0.85em; }
        .btn-danger { background: #c0392b; }
        .btn-success { background: #27ae60; }
        
        .search-box { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #c5a059; margin-bottom: 20px; font-size: 1.1em; outline: none; }
        .case-badge { background: #c5a059; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85em; margin-right: 10px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .judge-info { font-size: 0.85em; color: #1a237e; background: #eef2f7; padding: 15px; border-radius: 6px; margin-top: 15px; }
        .status-label { float: right; font-weight: bold; text-transform: uppercase; font-size: 0.75em; padding: 4px 10px; border-radius: 4px; background: #eee; }
    </style>
</head>
<body>
    <div class="nav">
        <h2>‚öñÔ∏è –í–ï–†–•–û–í–ù–´–ô –°–£–î</h2>
        <div>{{ user.username }} ({{ user.role }}) | <a href="/logout" style="color: gold; text-decoration: none;">–í—ã—Ö–æ–¥</a></div>
    </div>

    <div class="container">
        <input type="text" id="caseSearch" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –Ω–∏–∫—É...">

        <div class="card">
            <h3>üìù –ü–æ–¥–∞—á–∞ –Ω–æ–≤–æ–≥–æ –∏—Å–∫–∞</h3>
            <form action="/create_case" method="post">
                <select name="case_type">
                    <option value="GK">–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –¥–µ–ª–æ (GK)</option>
                    <option value="YD">–£–≥–æ–ª–æ–≤–Ω–æ–µ/–ê–¥–º–∏–Ω (YD)</option>
                    <option value="KA">–ö–∞—Å—Å–∞—Ü–∏—è (KA)</option>
                    <option value="GH">–í–µ—Ä—Ö–æ–≤–Ω—ã–π —Å—É–¥ (GH)</option>
                </select>
                <input type="text" name="title" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å–∫–∞" required>
                <textarea name="content" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ —Å—É—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è..." required></textarea>
                <button type="submit" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å–∫</button>
            </form>
        </div>

        <div id="casesList">
            {% for case in cases %}
            <div class="card case-card status-{{ case.status|replace(' ', '-') }}">
                <span class="status-label">{{ case.status }}</span>
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <span class="case-badge">{{ case.case_num }}</span>
                        <strong>{{ case.title }}</strong>
                    </div>
                    {% if user.role != '–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω' %}
                    <a href="/delete_case/{{ case.id }}" class="btn btn-sm btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å?')">–£–¥–∞–ª–∏—Ç—å</a>
                    {% endif %}
                </div>

                <p style="margin: 15px 0; font-size: 0.95em;">{{ case.content }}</p>

                {% if case.judge_id %}
                    <div class="judge-info">
                        <strong>üë®‚Äç‚öñÔ∏è –°—É–¥—å—è:</strong> {{ case.judge_id }}
                        {% if case.result %}
                            <p><strong>‚öñÔ∏è –í–µ—Ä–¥–∏–∫—Ç:</strong> {{ case.result }}</p>
                        {% elif user.username == case.judge_id %}
                            <form action="/answer_case/{{ case.id }}" method="post" style="margin-top: 10px;">
                                <textarea name="result" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ..." required></textarea>
                                <button type="submit" class="btn btn-sm btn-success">–í—ã–Ω–µ—Å—Ç–∏ –≤–µ—Ä–¥–∏–∫—Ç</button>
                            </form>
                        {% endif %}
                    </div>
                {% elif user.role != '–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω' %}
                    <a href="/take_case/{{ case.id }}" class="btn btn-sm btn-warn" style="background: #3498db;">–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        // –°–∫—Ä–∏–ø—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        document.getElementById('caseSearch').addEventListener('keyup', function() {
            let filter = this.value.toLowerCase();
            let cards = document.getElementsByClassName('case-card');
            for (let card of cards) {
                if (card.innerText.toLowerCase().includes(filter)) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            }
        });
    </script>
</body>
</html>
